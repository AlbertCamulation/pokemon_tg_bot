name: Daily PokÃ©mon Update (3-in-1)

on:
  schedule:
    # æ¯å¤©å°ç£æ™‚é–“æ—©ä¸Š 10 é» (UTC 02:00) åŸ·è¡Œä¸€æ¬¡
    - cron: '0 2 * * *'
  workflow_dispatch: 

jobs:
  update-all:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install requests beautifulsoup4 cloudscraper

      # 1. æŠ“å–ç•¶ä¸‹è¯ç›Ÿ (ç”¢ç”Ÿ manifest.json)
      # âš ï¸ æ³¨æ„è·¯å¾‘ï¼šç¾åœ¨è…³æœ¬å·²ç¶“æ¬åˆ° scripts/ åº•ä¸‹äº†
      - name: Run League Scraper
        run: python scripts/pk_grab_from_official.py

      # 2. æŠ“å–æ´»å‹•è¡¨ (ç”¢ç”Ÿ events.json)
      - name: Run Event Scraper
        run: python scripts/update_events.py

      # 3. æŠ“å–æ’åè³‡æ–™ (ç”¢ç”Ÿ rankings_xxx.json)
      - name: Run Ranking Scraper
        run: python scripts/fetch_data.py

      # ä¸€æ¬¡æ€§æŠŠä¸‰å€‹è…³æœ¬ç”¢ç”Ÿçš„è³‡æ–™æ‰“åŒ…æ¨ä¸Š GitHub
      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          git add data/
          
          if [ -n "$(git status --porcelain data/)" ]; then
            git commit -m "ğŸ¤– è‡ªå‹•æ›´æ–°: æ’å/æ´»å‹•/è¯ç›Ÿè³‡æ–™ ($(TZ='Asia/Taipei' date +'%Y-%m-%d %H:%M'))"
            git push origin main
            echo "âœ… æ‰€æœ‰è³‡æ–™å·²æ›´æ–°ä¸¦æ¨é€"
          else
            echo "â„¹ï¸ è³‡æ–™ç„¡è®Šå‹•ï¼Œè·³éæäº¤"
          fi
